<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PERTANDINGAN TINJU MATEMATIKA</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --p1: #3498db; --p1-dark: #2980b9;
            --p2: #e74c3c; --p2-dark: #c0392b;
            --text: #ecf0f1;
        }
        body {
            font-family: 'Press Start 2P', cursive;
            background: #111; color: var(--text);
            margin: 0; height: 100vh; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            user-select: none;
        }

        #menu-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.9), rgba(0,0,0,0.8)), 
                        url('https://img.freepik.com/premium-vector/pixel-art-boxing-ring-background_805576-88.jpg');
            background-size: cover; background-position: center;
            z-index: 100; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }
        h1 { 
            font-size: 40px; color: #f1c40f; text-shadow: 4px 4px #c0392b; 
            margin-bottom: 30px; animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        .menu-box { background: #222; border: 4px solid #fff; padding: 20px; border-radius: 10px; }
        .btn-group { margin: 20px 0; display: flex; gap: 10px; justify-content: center; }
        .btn {
            font-family: inherit; padding: 10px 15px; background: #444; color: #fff;
            border: 2px solid #777; cursor: pointer; transition: 0.2s; font-size: 12px;
        }
        .btn:hover { background: #666; }
        .btn.active { background: #27ae60; border-color: #2ecc71; box-shadow: 0 0 10px #27ae60; }
        .btn-start { font-size: 18px; padding: 15px 40px; background: #e67e22; border-color: #d35400; margin-top: 10px; }

        #game-layer {
            display: none; width: 900px; height: 650px;
            position: relative; flex-direction: column;
            background: #333; border: 8px solid #555;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .screen {
            position: relative; width: 100%; height: 500px;
            background: #87ceeb; overflow: hidden;
            border-bottom: 5px solid #000;
        }
        .bg-sky { position: absolute; width: 100%; height: 100%; background: linear-gradient(#2980b9, #fff); }
        .floor { position: absolute; bottom: 0; width: 100%; height: 120px; background: #7f8c8d; border-top: 8px solid #555; z-index: 2; }
        .rope { position: absolute; width: 100%; height: 5px; background: #c0392b; border: 1px solid #000; z-index: 5; }

        .hud {
            position: absolute; top: 0; width: 100%; padding: 20px;
            display: flex; justify-content: space-between; z-index: 10;
        }
        .hp-box { width: 300px; }
        .hp-bar { width: 100%; height: 20px; background: #333; border: 2px solid #fff; }
        .hp-fill { height: 100%; width: 100%; transition: width 0.3s; }
        #hp1 { background: var(--p1); } #hp2 { background: var(--p2); transform-origin: right; }
        .timer { font-size: 40px; color: #f1c40f; text-shadow: 2px 2px #000; }

        .char {
            width: 80px; height: 120px; position: absolute; bottom: 50px;
            transition: transform 0.1s; z-index: 4;
        }
        #p1 { left: 150px; color: var(--p1); }
        #p2 { right: 150px; color: var(--p2); transform: scaleX(-1); }
        
        .head { width: 40px; height: 40px; background: #f1c27d; position: absolute; top: 0; left: 20px; border: 3px solid #000; }
        .body { width: 50px; height: 60px; background: currentColor; position: absolute; top: 40px; left: 15px; border: 3px solid #000; }
        .glove { width: 30px; height: 30px; background: currentColor; position: absolute; border: 3px solid #000; filter: brightness(0.8); }
        .glove.l { top: 50px; left: -5px; } .glove.r { top: 60px; left: 45px; }

        .idle { animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0) scaleX(1); } 50% { transform: translateY(-5px) scaleX(1); } }
        #p2.idle { animation: bounceP2 1s infinite; }
        @keyframes bounceP2 { 0%, 100% { transform: translateY(0) scaleX(-1); } 50% { transform: translateY(-5px) scaleX(-1); } }

        .punch { animation: punchAnim 0.2s forwards; }
        @keyframes punchAnim { 50% { transform: translateX(80px) scaleX(1); } }
        #p2.punch { animation: punchAnimP2 0.2s forwards; }
        @keyframes punchAnimP2 { 50% { transform: translateX(80px) scaleX(-1); } }

        .hit { animation: shake 0.3s; filter: brightness(2) sepia(1) hue-rotate(-50deg); }
        @keyframes shake { 0%,100% {transform:translateX(0) scaleX(1);} 25% {transform:translateX(-10px) scaleX(1);} 75% {transform:translateX(10px) scaleX(1);} }
        #p2.hit { animation: shakeP2 0.3s; }
        @keyframes shakeP2 { 0%,100% {transform:translateX(0) scaleX(-1);} 25% {transform:translateX(-10px) scaleX(-1);} 75% {transform:translateX(10px) scaleX(-1);} }

        .question-modal {
            position: absolute; top: 150px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: #fff; padding: 10px 20px;
            border: 3px solid #fff; border-radius: 10px; text-align: center; z-index: 15;
        }
        .q-label { font-size: 10px; color: #aaa; display: block; margin-bottom: 5px; }
        .q-text { font-size: 30px; margin: 0; }

        .input-area {
            height: 150px; background: #222; display: flex;
            justify-content: space-around; align-items: center;
            border-top: 5px solid #555;
        }
        .col {
            display: flex; flex-direction: column; align-items: center;
            width: 40%; opacity: 0.5; transition: 0.3s;
        }
        .col.active { opacity: 1; transform: scale(1.05); }
        
        .col label { font-size: 12px; margin-bottom: 10px; color: #bbb; text-align: center; line-height: 1.5; }
        .key-hint { color: #f1c40f; font-weight: bold; }

        .ans-input {
            width: 100%; height: 50px; font-size: 24px; text-align: center;
            font-family: inherit; background: #111; border: 3px solid #444; color: #fff;
        }
        .ans-input:focus { outline: none; border-color: #f1c40f; box-shadow: 0 0 15px #f1c40f; }
        
        #in1 { border-color: var(--p1-dark); }
        #in2 { border-color: var(--p2-dark); }

        #win-overlay {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 200;
            flex-direction: column; justify-content: center; align-items: center;
        }
        .win-title { font-size: 50px; color: #f1c40f; animation: pulse 0.5s infinite; text-align: center; }
        
        .confetti { position: absolute; width: 10px; height: 10px; background: #f00; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }

    </style>
</head>
<body>

    <div id="menu-layer">
        <h1>PERTANDINGAN TINJU<br>MATEMATIKA</h1>
        <div class="menu-box">
            <div style="margin-bottom: 10px; color: #aaa; font-size: 10px;">UNTUK MENGISI KEKOSONGANMU ;>!</div>
            <div class="btn-group">
                <button class="btn active" onclick="setMode('pvp', this)">LAWAN TEMAN</button>
                <button class="btn" onclick="setMode('pve', this)">LAWAN BOT</button>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="setDiff('easy', this)">MUDAH<br>(Perkalian)</button>
                <button class="btn active" onclick="setDiff('normal', this)">NORMAL<br>(Akar)</button>
                <button class="btn" onclick="setDiff('hard', this)">SULIT<br>(Aritmatika)</button>
            </div>
            <button class="btn btn-start" onclick="startGame()">MULAI!</button>
        </div>
    </div>

    <div id="game-layer">
        <div class="screen">
            <div class="bg-sky"></div>
            <div class="floor"></div>
            <div class="rope" style="bottom: 80px"></div>
            <div class="rope" style="bottom: 50px"></div>

            <div class="hud">
                <div class="hp-box">
                    <div style="color:var(--p1); font-size:12px; margin-bottom:5px;">PETARUNG 1</div>
                    <div class="hp-bar"><div class="hp-fill" id="hp1"></div></div>
                </div>
                <div class="timer" id="timer">00</div>
                <div class="hp-box" style="text-align:right;">
                    <div style="color:var(--p2); font-size:12px; margin-bottom:5px;" id="p2-label">PETARUNG 2</div>
                    <div class="hp-bar"><div class="hp-fill" id="hp2"></div></div>
                </div>
            </div>

            <div class="question-modal">
                <span class="q-label" id="q-topic">TOPIC</span>
                <h2 class="q-text" id="q-text">SIAP?</h2>
            </div>

            <div class="char idle" id="p1">
                <div class="head"></div><div class="body"></div>
                <div class="glove l"></div><div class="glove r"></div>
            </div>
            <div class="char idle" id="p2">
                <div class="head"></div><div class="body"></div>
                <div class="glove l"></div><div class="glove r"></div>
            </div>

            <div id="win-overlay">
                <div class="win-title" id="win-msg">TUMBANG!</div>
                <button class="btn btn-start" onclick="location.reload()">MAIN LAGI</button>
            </div>
        </div>

        <div class="input-area">
            <div class="col" id="col1">
                <label>P1: <span class="key-hint">[Q]</span> / <span class="key-hint">[ENTER]</span></label>
                <input type="number" id="in1" class="ans-input" placeholder="Q...">
            </div>
            <div class="col" id="col2">
                <label id="lbl2">P2: <span class="key-hint">[P]</span> / <span class="key-hint">[SPACE]</span></label>
                <input type="number" id="in2" class="ans-input" placeholder="P...">
            </div>
        </div>
    </div>

    <script>
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx;
        let bgmInterval;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playBGM() {
            if (bgmInterval) clearInterval(bgmInterval);
            let note = 0;
            bgmInterval = setInterval(() => {
                if(!state.active) return;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'square';
                
                const freqs = [110, 103, 98, 103]; 
                osc.frequency.setValueAtTime(freqs[note % 4], audioCtx.currentTime);
                
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);

                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.2);
                note++;
            }, 250);
        }

        function sfxPunch() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function sfxWin() {
            clearInterval(bgmInterval);
            const now = audioCtx.currentTime;
            [440, 554, 659, 880].forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(0.2, now + i*0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, now + i*0.1 + 0.5);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i*0.1);
                osc.stop(now + i*0.1 + 0.5);
            });
        }

        const config = { mode: 'pvp', diff: 'normal', time: 15, type: 'root' };
        const diffs = {
            easy: { t: 6, type: 'mult', txt: 'PERKALIAN' },
            normal: { t: 15, type: 'root', txt: 'AKAR' },
            hard: { t: 60, type: 'arith', txt: 'ARITMATIKA' }
        };

        let state = { 
            hp1: 100, hp2: 100, active: false, 
            ans: 0, timer: 0, interval: null, botTimer: null 
        };

        const elMenu = document.getElementById('menu-layer');
        const elGame = document.getElementById('game-layer');
        const elQ = document.getElementById('q-text');
        const elTimer = document.getElementById('timer');
        const in1 = document.getElementById('in1');
        const in2 = document.getElementById('in2');
        const char1 = document.getElementById('p1');
        const char2 = document.getElementById('p2');

        function setMode(m, btn) {
            config.mode = m;
            document.querySelectorAll('.btn-group:first-of-type .btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
        }

        function setDiff(d, btn) {
            config.diff = d;
            document.querySelectorAll('.btn-group:last-of-type .btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
        }

        function startGame() {
            initAudio();
            playBGM();

            elMenu.style.display = 'none';
            elGame.style.display = 'flex';

            const set = diffs[config.diff];
            config.time = set.t;
            config.type = set.type;
            document.getElementById('q-topic').textContent = set.txt;

            if(config.mode === 'pve') {
                document.getElementById('p2-label').textContent = "BOT";
                document.getElementById('lbl2').innerHTML = "BOT<br>SEDANG<br>BERPIKIR...";
                in2.disabled = true;
                in2.placeholder = "...";
            } else {
                document.getElementById('p2-label').textContent = "PLAYER 2";
                document.getElementById('lbl2').innerHTML = "P2: <span class='key-hint'>[P]</span> / <span class='key-hint'>[SPACE]</span>";
                in2.disabled = false;
                in2.placeholder = "P...";
            }

            nextRound();
        }

        function nextRound() {
            if(state.hp1 <= 0 || state.hp2 <= 0) return;
            
            state.active = true;
            let q = "", a = 0;
            if(config.type === 'mult') {
                const n1 = Math.floor(Math.random()*9)+2;
                const n2 = Math.floor(Math.random()*9)+2;
                a = n1*n2; q = `${n1} x ${n2}`;
            } else if(config.type === 'root') {
                const n = Math.floor(Math.random()*19)+2;
                a = n; q = `âˆš${n*n}`;
            } else {
                const n1=Math.floor(Math.random()*10)+5;
                const n2=Math.floor(Math.random()*5)+2;
                const n3=Math.floor(Math.random()*20)+1;
                a = n1*n2+n3; q = `${n1}x${n2} + ${n3}`;
            }
            
            elQ.textContent = `${q} = ?`;
            state.ans = a;

            in1.value = ''; in2.value = '';
            in1.blur(); in2.blur();
            document.getElementById('col1').classList.remove('active');
            document.getElementById('col2').classList.remove('active');

            clearInterval(state.interval);
            clearTimeout(state.botTimer);
            state.timer = config.time;
            elTimer.textContent = state.timer;
            
            state.interval = setInterval(() => {
                state.timer--;
                elTimer.textContent = state.timer;
                if(state.timer <= 0) {
                    state.active = false;
                    elQ.textContent = "WAKTU HABIS!";
                    clearInterval(state.interval);
                    setTimeout(nextRound, 1500);
                }
            }, 1000);

            if(config.mode === 'pve') {
                let delay = (config.diff === 'easy' ? 3000 : (config.diff === 'normal' ? 5000 : 8000));
                delay = Math.random() * delay + 2000;
                if(delay > (config.time*1000)) delay = (config.time*1000) - 500;

                state.botTimer = setTimeout(() => {
                    if(!state.active) return;
                    in2.value = state.ans;
                    checkAns('p2', state.ans);
                }, delay);
            }
        }

        document.addEventListener('keydown', (e) => {
            if(!state.active) return;

            if(e.key.toLowerCase() === 'q') {
                e.preventDefault();
                in1.focus();
                document.getElementById('col1').classList.add('active');
                if(config.mode==='pvp') document.getElementById('col2').classList.remove('active');
            }
            if(e.key === 'Enter' && document.activeElement === in1) {
                checkAns('p1', parseInt(in1.value));
            }

            if(config.mode === 'pvp') {
                if(e.key.toLowerCase() === 'p') {
                    e.preventDefault();
                    in2.focus();
                    document.getElementById('col2').classList.add('active');
                    document.getElementById('col1').classList.remove('active');
                }
                if(e.code === 'Space' && document.activeElement === in2) {
                    e.preventDefault();
                    checkAns('p2', parseInt(in2.value));
                }
            }
        });

        function checkAns(p, val) {
            if(!state.active) return;

            if(val === state.ans) {
                state.active = false;
                clearInterval(state.interval);
                clearTimeout(state.botTimer);
                attack(p);
            } else {
                if(p==='p1') { in1.value=''; in1.placeholder='X'; setTimeout(()=>in1.placeholder='Q...',500); }
                else { in2.value=''; in2.placeholder='X'; setTimeout(()=>in2.placeholder='P...',500); }
            }
        }

        function attack(attacker) {
            sfxPunch();

            const isP1 = attacker === 'p1';
            const atk = isP1 ? char1 : char2;
            const vic = isP1 ? char2 : char1;

            atk.classList.remove('idle');
            atk.classList.add('punch');

            setTimeout(() => {
                vic.classList.add('hit');
                if(isP1) state.hp2 -= 20; else state.hp1 -= 20;
                updateHP();
            }, 100);

            setTimeout(() => {
                atk.classList.remove('punch');
                atk.classList.add('idle');
                vic.classList.remove('hit');
                
                if(state.hp1 <= 0 || state.hp2 <= 0) winGame(isP1 ? 'PLAYER 1' : (config.mode === 'pve' ? 'BOT' : 'PLAYER 2'));
                else nextRound();
            }, 800);
        }

        function updateHP() {
            document.getElementById('hp1').style.width = Math.max(0, state.hp1)+'%';
            document.getElementById('hp2').style.width = Math.max(0, state.hp2)+'%';
        }

        function winGame(winner) {
            state.active = false;
            sfxWin();

            const ov = document.getElementById('win-overlay');
            const title = document.getElementById('win-msg');
            
            title.innerHTML = `${winner}<br>WINS!`;
            ov.style.display = 'flex';

            for(let i=0; i<50; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.left = Math.random()*100 + '%';
                c.style.background = `hsl(${Math.random()*360}, 100%, 50%)`;
                c.style.animationDuration = (Math.random()*2 + 1) + 's';
                ov.appendChild(c);
            }
        }
    </script>
</body>
</html>